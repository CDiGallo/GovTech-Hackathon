<html>
Hi GovTech Hackers!
adapted from here => https://github.com/vasturiano/sunburst-chart
<body>
<style>
.node {
  cursor: pointer;
}

.node circle {
  fill: #fff;
  stroke: steelblue;
  stroke-width: 1.5px;
}

.node text {
  font: 10px sans-serif;
}

.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 1.5px;
}
</style>

<script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>

<script src="https://unpkg.com/sunburst-chart@1.17.1/dist/sunburst-chart.js"></script>

<div id="chart"></div>
<script>

// Fetch data
let rootNode = {
	"name": "Root",
	"value": 0,
	"children" : []
};

let dataAll = [];

async function asyncCall(parentid, parentNode, level) {

	let queryBody = "";
	queryBody += "PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> ";
	queryBody += "PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> ";
	queryBody += "SELECT * WHERE { ";
	queryBody += "?child <https://www.ica.org/standards/RiC/ontology#isOrWasIncludedIn> <https://culture.ld.admin.ch/ais/" + parentid + ">. ";
	queryBody += "?child <https://www.ica.org/standards/RiC/ontology#title> ?child_title. ";
    queryBody += "?child <https://schema.ld.admin.ch/position> ?position. ";
	queryBody += "} ORDER BY ASC(?position) LIMIT 100";

	var details = {
		'query': queryBody,
		'lang': 'de'
	};
	
	var formBody = [];
	for (var property in details) {
	var encodedKey = encodeURIComponent(property);
	var encodedValue = encodeURIComponent(details[property]);
	formBody.push(encodedKey + "=" + encodedValue);
	}
	formBody = formBody.join("&");

	let response = await fetch(
		"https://lindas.admin.ch/query",
		{
			method: 'POST',
			headers: {
				'accept' : "application/sparql-results+json,*/*;q=0.9",
				'content-type' : "application/x-www-form-urlencoded"
			},
			body: formBody
		}
	);

	let responsejson = await response.json(); 
	let childs = responsejson['results']['bindings']

	await fetchChildren(childs, parentNode, level);
}

async function fetchChildren(childs, parentNode, level) {

	let fetchCalls = [];

	for (let i in childs) {

		let nextId = childs[i].child.value.replace("https://culture.ld.admin.ch/ais/", "");

		let newNode = {
			"name": childs[i].child_title.value,
			"value": nextId,
			"children" : []
		}

		if (level > 0) {
			let levelnew = level - 1;
			fetchCalls.push(asyncCall(nextId, newNode, levelnew));
		}

		parentNode.children.push(newNode);
	}
	await Promise.all(fetchCalls);
} 

asyncCall(1, rootNode, 2).then(()=> {
	visualizedata(rootNode);
});

// Viszualize data
// alternative : https://observablehq.com/@d3/zoomable-sunburst

const color = d3.scaleOrdinal(d3.schemeCategory10);

/*var diameter = 800;

var margin = {top: 20, right: 120, bottom: 20, left: 120},
	width = diameter,
	height = diameter;
	
var i = 0,
	duration = 350,
	root;

var tree = d3.layout.tree()
	.size([360, diameter / 2 - 80])
	.separation(function(a, b) { return (a.parent == b.parent ? 1 : 10) / a.depth; });
	

var diagonal = d3.svg.diagonal.radial()
	.projection(function(d) { return [d.y, d.x / 180 * Math.PI]; });

var svg = d3.select("body").append("svg")
	.attr("width", width )
	.attr("height", height )
  .append("g")
	.attr("transform", "translate(" + diameter / 2 + "," + diameter / 2 + ")"); */

function visualizedata(adapteddata) {
    Sunburst()
      .data(adapteddata)
      .color(d => color(d.name))
      /*.minSliceAngle(.4)*/
      .excludeRoot(true)
      .maxLevels(2)
      .showLabels(true)
  //    .tooltipContent((d, node) => `Size: <i>${node.value}</i>`)
    (document.getElementById('chart'));
	}
  </script>
</body>
